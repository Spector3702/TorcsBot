import pickle
import matplotlib.pyplot as plt

FOLDER_NAME = 'TORCS_NEAT'
# Load rewards from the saved file
with open(f'{FOLDER_NAME}/neat_rewards.pkl', 'rb') as f:
    all_rewards = pickle.load(f)

#all_rewards = [[0.609499779685858], [-3.5357234628389116], [213.52834393547633], [-0.6434442867690054], [3.210526174001494], [-69.41557066488346], [-216.78788667574224], [1690.9639181885648], [28.006091426875788], [0.08246279120265039], [1690.9639181885648], [213.52834393547633], [-0.6434442867690054], [1.1223584824608772], [-2.2669854762473873], [-365.6760551189926], [21.150415816220146], [-104.89709785214697], [44.39771925457885], [1660.080083454008], [1690.9639181885648], [1660.080083454008], [48.56796665724423], [2.815856589839975], [-297.96392312950525], [394.59517698059824], [-52.03888947687755], [0.5010154819230306], [-249.51848606416812], [186.12819288638352], [1690.9639181885648], [1660.080083454008], [48.56796665724423], [2.815856589839975], [-297.96392312950525], [394.59517698059824], [-52.03888947687755], [0.5010154819230306], [-249.51848606416812], [186.12819288638352]]

# Calculate the average reward for each group of 10 generations
l = len(all_rewards) // 10
avg = []
all_rewards_alt = [item for sublist in all_rewards for item in sublist]
for i in range(l):
    gen = all_rewards_alt[i * 10: (i + 1) * 10]
    total = sum(_ for _ in gen)
    avg.append(total / 10)

plt.figure(figsize=(10, 5))  # Adjust figure size if needed
plt.subplot(1, 2, 1)  # Subplot: 1 row, 2 columns, plot 1
print(avg)
# Plot the average rewards with generations as x-axis
plt.plot(avg, marker='o')
plt.xlabel('Generations')
plt.ylabel('Average Reward')
plt.title('Average Reward per Generation')

# Set integer ticks for x-axis
x_ticks = list(range(0, len(avg) * 1, 1))
plt.xticks(x_ticks, x_ticks)
plt.grid(True)
print(len(all_rewards_alt))
plt.subplot(1, 2, 2)  # Subplot: 1 row, 2 columns, plot 2
plt.plot(all_rewards_alt, marker='o', color='orange')
plt.xlabel('Episodes')
plt.ylabel('Reward')
plt.title('Reward per Episode')

plt.show()

"""
test case (size = 40)
[[0.609499779685858], [-3.5357234628389116], [213.52834393547633], [-0.6434442867690054], [3.210526174001494], [-69.41557066488346], [-216.78788667574224], [1690.9639181885648], [28.006091426875788], [0.08246279120265039], [1690.9639181885648], [213.52834393547633], [-0.6434442867690054], [1.1223584824608772], [-2.2669854762473873], [-365.6760551189926], [21.150415816220146], [-104.89709785214697], [44.39771925457885], [1660.080083454008], [1690.9639181885648], [1660.080083454008], [48.56796665724423], [2.815856589839975], [-297.96392312950525], [394.59517698059824], [-52.03888947687755], [0.5010154819230306], [-249.51848606416812], [186.12819288638352], [1690.9639181885648], [1660.080083454008], [48.56796665724423], [2.815856589839975], [-297.96392312950525], [394.59517698059824], [-52.03888947687755], [0.5010154819230306], [-249.51848606416812], [186.12819288638352]]
"""